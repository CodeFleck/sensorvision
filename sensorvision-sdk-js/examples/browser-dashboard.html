<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SensorVision Browser Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .status {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }

        .status.connected {
            background: #d4edda;
            color: #155724;
        }

        .status.disconnected {
            background: #f8d7da;
            color: #721c24;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background: #667eea;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        button:hover {
            background: #5568d3;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .telemetry-list {
            list-style: none;
        }

        .telemetry-item {
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            margin-bottom: 10px;
            background: #f9f9f9;
        }

        .telemetry-item .device-id {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .telemetry-item .timestamp {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }

        .telemetry-item .variables {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }

        .variable {
            background: white;
            padding: 8px;
            border-radius: 3px;
            font-size: 14px;
        }

        .variable-name {
            color: #666;
            font-size: 12px;
        }

        .variable-value {
            color: #333;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üå°Ô∏è SensorVision Dashboard</h1>

        <div id="status" class="status disconnected">Disconnected</div>

        <div class="controls">
            <button id="connectBtn" onclick="connect()">Connect WebSocket</button>
            <button id="disconnectBtn" onclick="disconnect()" disabled>Disconnect</button>
            <button id="sendDataBtn" onclick="sendTestData()">Send Test Data</button>
        </div>

        <h2>Real-time Telemetry</h2>
        <ul id="telemetryList" class="telemetry-list"></ul>
    </div>

    <!-- Include the SDK -->
    <script src="../dist/index.umd.js"></script>

    <script>
        // Initialize clients
        const httpClient = new SensorVision.SensorVisionClient({
            apiUrl: 'http://localhost:8080',
            apiKey: 'your-device-token'
        });

        const wsClient = new SensorVision.WebSocketClient({
            wsUrl: 'ws://localhost:8080/ws/telemetry',
            apiKey: 'your-api-key',
            reconnect: true
        });

        const deviceIds = ['sensor-001', 'sensor-002', 'sensor-003'];
        const telemetryData = [];
        const maxItems = 10;

        // Connect WebSocket
        async function connect() {
            try {
                document.getElementById('connectBtn').disabled = true;
                updateStatus('Connecting...');

                await wsClient.connect();
                updateStatus('Connected', true);

                // Subscribe to devices
                deviceIds.forEach(deviceId => {
                    wsClient.subscribe(deviceId, (data) => {
                        addTelemetryItem(data);
                    });
                });

                document.getElementById('disconnectBtn').disabled = false;
            } catch (error) {
                console.error('Connection error:', error);
                updateStatus('Connection failed', false);
                document.getElementById('connectBtn').disabled = false;
            }
        }

        // Disconnect WebSocket
        function disconnect() {
            wsClient.disconnect();
            updateStatus('Disconnected', false);
            document.getElementById('connectBtn').disabled = false;
            document.getElementById('disconnectBtn').disabled = true;
        }

        // Send test data via HTTP
        async function sendTestData() {
            try {
                const deviceId = deviceIds[Math.floor(Math.random() * deviceIds.length)];
                const data = {
                    temperature: parseFloat((20 + Math.random() * 10).toFixed(2)),
                    humidity: parseFloat((50 + Math.random() * 30).toFixed(2)),
                    pressure: parseFloat((1000 + Math.random() * 30).toFixed(2))
                };

                const response = await httpClient.sendData(deviceId, data);
                console.log('Data sent:', response);
            } catch (error) {
                console.error('Error sending data:', error);
                alert('Failed to send data: ' + error.message);
            }
        }

        // Update connection status
        function updateStatus(message, isConnected) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = 'status ' + (isConnected ? 'connected' : 'disconnected');
        }

        // Add telemetry item to list
        function addTelemetryItem(data) {
            telemetryData.unshift(data);
            if (telemetryData.length > maxItems) {
                telemetryData.pop();
            }
            renderTelemetry();
        }

        // Render telemetry list
        function renderTelemetry() {
            const listEl = document.getElementById('telemetryList');
            listEl.innerHTML = telemetryData.map(item => `
                <li class="telemetry-item">
                    <div class="device-id">${item.deviceId}</div>
                    <div class="timestamp">${new Date(item.timestamp).toLocaleString()}</div>
                    <div class="variables">
                        ${Object.entries(item.variables).map(([key, value]) => `
                            <div class="variable">
                                <div class="variable-name">${key}</div>
                                <div class="variable-value">${typeof value === 'number' ? value.toFixed(2) : value}</div>
                            </div>
                        `).join('')}
                    </div>
                </li>
            `).join('');
        }

        // Handle errors
        wsClient.onError((error) => {
            console.error('WebSocket error:', error);
        });
    </script>
</body>
</html>
